<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blueprint Overview</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <div>
                <h1 id="process-name">Blueprint App</h1>
                <span id="readiness-badge" class="badge todo">
                    <span id="readiness-text">Loading...</span>
                </span>
            </div>
        </header>

        <div class="actions">
            <button onclick="exportYAML()">Export Manifest (YAML)</button>
            <button onclick="exportJSON()">Export Manifest (JSON)</button>
            <button id="copy-scaffold" class="primary" onclick="copyClaudeScaffold()">Copy Claude Scaffold</button>
        </div>

        <div class="bucket-cards">
            <div class="card">
                <h3>Input <span id="input-badge" class="small-badge badge todo">0%</span></h3>
                <p>Ingestion and validation</p>
                <button id="copy-input" onclick="copyBucketPrompt('input')">Copy Input Prompt</button>
            </div>
            <div class="card">
                <h3>Middle <span id="middle-badge" class="small-badge badge todo">0%</span></h3>
                <p>Processing and transformation</p>
                <button id="copy-middle" onclick="copyBucketPrompt('middle')">Copy Middle Prompt</button>
            </div>
            <div class="card">
                <h3>Output <span id="output-badge" class="small-badge badge todo">0%</span></h3>
                <p>Publishing and distribution</p>
                <button id="copy-output" onclick="copyBucketPrompt('output')">Copy Output Prompt</button>
            </div>
        </div>

        <div class="mermaid-container">
            <pre class="mermaid" id="overview-diagram">
flowchart LR
    classDef done fill:#22c55e,stroke:#15803d,color:#fff;
    classDef wip fill:#f59e0b,stroke:#b45309,color:#111;
    classDef todo fill:#ef4444,stroke:#7f1d1d,color:#fff;
    
    subgraph INPUT["INPUT"]
        input_one_liner["one_liner<br/>What do we accept/reject?"]:::todo
        input_sources["sources<br/>Sources, triggers, prechecks"]:::todo
        input_contract["contract<br/>Input schema & idempotency"]:::todo
        input_intake_steps["intake_steps<br/>Intake steps & params"]:::todo
        input_fixtures["fixtures<br/>Examples & acceptance"]:::todo
        input_one_liner --> input_sources
        input_sources --> input_contract
        input_contract --> input_intake_steps
        input_intake_steps --> input_fixtures
    end
    
    subgraph MIDDLE["MIDDLE"]
        middle_frame["frame<br/>What value we add"]:::todo
        middle_state_machine["state_machine<br/>States & owners"]:::todo
        middle_gates["gates<br/>Validation gates & invariants"]:::todo
        middle_transform["transform<br/>Transform / enrich (idempotent)"]:::todo
        middle_tests["tests<br/>Fixtures & simulator"]:::todo
        middle_staging["staging<br/>Stage to working store + events"]:::todo
        middle_frame --> middle_state_machine
        middle_state_machine --> middle_gates
        middle_gates --> middle_transform
        middle_transform --> middle_tests
        middle_tests --> middle_staging
    end
    
    subgraph OUTPUT["OUTPUT"]
        output_frame["frame<br/>Who gets what (and why now)"]:::todo
        output_destinations["destinations<br/>Destinations & consumers"]:::todo
        output_promotion["promotion<br/>Output schema, promotion gate, audit"]:::todo
        output_publish["publish<br/>UPSERT, notifications, retention, events"]:::todo
        output_frame --> output_destinations
        output_destinations --> output_promotion
        output_promotion --> output_publish
    end
    
    INPUT --> MIDDLE
    MIDDLE --> OUTPUT
            </pre>
        </div>

        <div class="navigation">
            <a href="input.html">Input Page →</a>
            <a href="middle.html">Middle Page →</a>
            <a href="output.html">Output Page →</a>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
</body>
</html>